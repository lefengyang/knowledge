
原文地址：
* [京东商品详情页应对“双11”大流量的技术实践](https://mp.weixin.qq.com/s/ezYqgYPCRe0oNgbn2AE9zA)

## 京东详情页技术架构发展
- 2012  动态页面  IIS + C# + Sql Server
- 2013  静态页面  Nginx + Java
- 2014  动态页面  Nginx + Lua + NoSQL
- 2015  全面接入弹性云


> 早期京东商品详情页还使用过页面片段的技术：就是通过JAVA生成页面的片段。输出时将一个个片段吐出。但这里会遇到的问题有这些：
1. 生成很多小文件
1. 磁盘要多次IO，大流量时很慢
1. 受inode数量限制
1. 页面某个内容改变，需要全量刷新相关的页面片段，而且有可能将依赖的服务刷挂


## 解决
1. 将模板存到缓存
1. 使用数据异构系统，将相关数据全抓过来，也存到缓存
1. 前端用Nginx + Lua输出


---


**数据异构系统**：要求别人将数据按照我们自己的维度和格式进行存储到缓存，或者通过接口拉取数据后，按自己的维度和格式存储到缓存。存储后就不依赖其他系统了，别人如何抖动不影响我们，只是数据不能更新而已。


## 数据异构系统核心思想
1.  数据要原子化(即没有进行加工过的，这样你就可以进行加工利用)
2.  维度化存储(如商品介绍、分类、商家、品牌，按不同维度划分)
3.  监控。监控每个依赖的服务的质量。
4.  可随时开关降级或做其他的控制。


## 数据异构系统的接入层
1.  统一入口。方便排查问题。
2.  做监控。
3.  可以做开关。例如做灰度发布，将少部分流量引到新版做逻辑验证，通过后再全量放开；进行AB测试；或者线上压测。
4.  服务出问题时立即进行降级。
5.  限流。
6.  服务的隔离。


## 服务的隔离
1.  例如我有一个业务，非常多人依赖我，那我可以进行分组。A部门调用A分组，B部门调用B分组。这样A分组的服务挂了，不影响B分组。
2.  例如有一些恶意流量过来了，可以导到一个专门的分组去。虽然能用，但是慢。


## 降级
1.  对于不重要的数据，例如超过500毫秒，就自动降级，这个数据不输出了。
2.  列表页的前10页缓存起来，如果服务挂了，可以将这个缓存数据发出来。
3.  发现是爬虫或恶意流量时，可以提供降级的服务。


## 压测
不能用单个URL进行压测，因为单个URL肯定是热点。要将线上的真实流量复制过来进行压测。
